// Jenkinsfile-regression (For the Nightly Full Regression Suite)

pipeline {
    agent any

    tools {
        maven 'apache-maven-3.9.9' // Your specific Maven tool name
        jdk 'JDK 21'             // Your specific JDK tool name
    }

    stages {
        stage('Clean Workspace') {
            steps {
                echo 'Cleaning up the workspace...'
                cleanWs()
            }
        }

        stage('Checkout SCM') {
            steps {
                echo 'Checking out code from GitHub...'
                checkout scm
            }
        }

        stage('Build & Run Regression Tests') {
            steps {
                echo 'Building the project and running the FULL regression test suite...'
                // We activate the 'regression' profile using the -P flag.
                bat 'mvn clean test -P regression -Denv=PRODUCTION'
            }
        }

        stage('Archive Regression Report') {
            steps {
                always {
                    echo 'Preparing and archiving the HTML test report...'
                    
                    // --- CORRECTED LOGIC ---
                    // Step 1: Rename the generic report to a specific one for the regression run.
                    bat 'if exist reports\\extent-report.html (move reports\\extent-report.html reports\\regression-report.html)'
                    
                    // Step 2: Archive the newly named file.
                    archiveArtifacts artifacts: 'reports/regression-report.html', allowEmptyArchive: true
                }
            }
        }
    }
}